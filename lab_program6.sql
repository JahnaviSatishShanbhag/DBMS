CREATE DATABASE movie_database;

USE movie_database;

CREATE TABLE ACTOR (
ACT_ID int,
ACT_NAME VARCHAR (20),
ACT_GENDER CHAR (1),
PRIMARY KEY (ACT_ID)
);

CREATE TABLE DIRECTOR (
DIR_ID int,
DIR_NAME VARCHAR (20),
DIR_PHONE VARCHAR (15),
PRIMARY KEY (DIR_ID)
);

CREATE TABLE MOVIES (
MOV_ID int,
MOV_TITLE VARCHAR (25),
MOV_YEAR int,
MOV_LANG VARCHAR (12),
DIR_ID int,
PRIMARY KEY (MOV_ID),
FOREIGN KEY (DIR_ID) REFERENCES DIRECTOR (DIR_ID)
);

CREATE TABLE MOVIE_CAST (
ACT_ID int ,
MOV_ID int ,
ROLE VARCHAR (10),
PRIMARY KEY (ACT_ID, MOV_ID),
FOREIGN KEY (ACT_ID) REFERENCES ACTOR (ACT_ID),
FOREIGN KEY (MOV_ID) REFERENCES MOVIES (MOV_ID)
);

CREATE TABLE RATING (
MOV_ID int,
REV_STARS VARCHAR (25),
PRIMARY KEY (MOV_ID),
FOREIGN KEY (MOV_ID) REFERENCES MOVIES (MOV_ID)
);

INSERT INTO ACTOR VALUES (301,"ANUSHKA","F");
INSERT INTO ACTOR VALUES (302,"PRABHAS","M");
INSERT INTO ACTOR VALUES (303,"PUNITH","M");
INSERT INTO ACTOR VALUES (304,"JERMY","M");

INSERT INTO DIRECTOR VALUES (60,"RAJAMOULI", "8751611001");
INSERT INTO DIRECTOR VALUES (61,"HITCHCOCK", "7766138911");
INSERT INTO DIRECTOR VALUES (62,"FARAN", "9986776531");
INSERT INTO DIRECTOR VALUES (63,"STEVEN SPIELBERG", "8989776530");

INSERT INTO MOVIES VALUES (1001,"BAHUBALI-2", 2017, "TELAGU", 60);
INSERT INTO MOVIES VALUES (1002,"BAHUBALI-1", 2015, "TELAGU", 60);
INSERT INTO MOVIES VALUES (1003,"AKASH", 2008, "KANNADA", 61);
INSERT INTO MOVIES VALUES (1004,"WAR HORSE", 2011, "ENGLISH", 63);

INSERT INTO MOVIE_CAST VALUES (301, 1002, "HEROINE");
INSERT INTO MOVIE_CAST VALUES (301, 1001, "HEROINE");
INSERT INTO MOVIE_CAST VALUES (303, 1003, "HERO");
INSERT INTO MOVIE_CAST VALUES (303, 1002, "GUEST");
INSERT INTO MOVIE_CAST VALUES (304, 1004, "HERO");

INSERT INTO RATING VALUES (1001, 4);
INSERT INTO RATING VALUES (1002, 2);
INSERT INTO RATING VALUES (1003, 5);
INSERT INTO RATING VALUES (1004, 4);

SELECT m.MOV_TITLE FROM movies m,director d
WHERE m.DIR_ID=d.DIR_ID
AND
d.DIR_NAME="HITCHCOCK";

SELECT DISTINCT m.MOV_TITLE FROM movies m,movie_cast mc
WHERE m.MOV_ID=mc.MOV_ID
AND
mc.ACT_ID IN (SELECT ACT_ID FROM movie_cast
GROUP BY ACT_ID
HAVING COUNT(*)>=2);

SELECT a.ACT_NAME,m.MOV_TITLE,m.MOV_YEAR FROM actor a,movies m,movie_cast mc
WHERE a.ACT_ID=mc.ACT_ID
AND
m.MOV_ID=mc.MOV_ID
AND
m.MOV_YEAR NOT BETWEEN 2000 AND 2015;

SELECT m.MOV_TITLE,MAX(r.REV_STARS) FROM movies m,rating r
WHERE m.MOV_ID=r.MOV_ID
GROUP BY r.MOV_ID
HAVING MAX(r.REV_STARS)>0
ORDER BY m.MOV_TITLE;

UPDATE RATING r
SET r.REV_STARS=5
WHERE r.MOV_ID IN (SELECT DISTINCT m.MOV_ID FROM movies m
WHERE m.DIR_ID=(SELECT DIR_ID FROM director WHERE DIR_NAME="STEVEN SPIELBERG"));

SELECT * FROM RATING;
